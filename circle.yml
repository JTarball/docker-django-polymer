#####
# Circle CI
# 
# For running docker images on circle ci, see: https://circleci.com/docs/docker
# For circle.yml explanation, see: https://circleci.com/docs/manually
# Python specific configuration, see: https://circleci.com/docs/language-python
#####

machine:
    services:
        - docker

dependencies:
    pre:
        - sudo killall redis-server 
        - sudo killall postgres
        - docker info
        - sudo pip install docker-compose
        - docker-compose up -d
test:
  override:
  # APP_DIR START
    - docker-compose run app sh -c "mkdir -p $CIRCLE_TEST_REPORTS/django && cd backend/ && py.test --junitxml=$CIRCLE_TEST_REPORTS/django/junit.xml apps/blog"


#test:
#    override:
        #CIRCLE_TEST_REPORTS=/home/ubuntu/docker-django-polymer/docker/app/app/backend/circle-junit
        # WORKAROUND: WAITING FOR FIX - CREATE LOG FILES in github
        #- docker-compose run app sh -c 'python ci.py && REUSE_DB=0 python backend/manage.py test --settings=project.settings.test blog' 
#         - sleep 10
#         - curl --retry 10 --retry-delay 5 -vk https://localhost:9443

# Running tests 'inside' container
# test:
#   override:
#     - ./fig run -d app python /srv/django/starter/manage.py test